<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Melodify</title>
    <link rel="stylesheet" href="../style/index.css">
    <link rel="stylesheet" href="../style/style.css">
    <link rel="stylesheet" href="../style/album.css">
    <link rel="stylesheet" href="../style/search.css">
    <link rel="stylesheet" href="../style/controls.css">

    <script src="../js/theme.js"></script>
    <script src="../js/toggleSidebar.js"></script>
    <script src="../js/toggleQueue.js"></script>
    <script src="../js/player.js" defer></script>
    <script src="../js/jwt.js" defer></script>
    <script src="../js/redirectToLogin.js" defer></script>
    <script src="../js/fetch.js" defer></script>
    <script src="../js/redirect.js" defer></script>

    <script src="https://kit.fontawesome.com/5c9473fc67.js" crossorigin="anonymous"></script>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const albumId = urlParams.get('id');

        fetch(`/api/albums/${albumId}`)
            .then(response => response.json())
            .then(albumData => {
                document.querySelector('#album h1').innerText = albumData.name;
                document.querySelector('.artist-info p').innerText = albumData.artists[0].name;
                document.querySelector('.additional_info > p').innerText = albumData.release_date;

                const albumImage = document.querySelector('.media-banner img');
                albumImage.src = albumData.image;

                const songList = document.querySelector('.song_list tbody');
                songList.innerHTML = '';
                let songOrder = 1;
                albumData.songs.forEach(song => {
                    const newRow = document.createElement('tr');
                    const artists = song.artists.map(artist => {
                        return `<button class="a" onclick="navigate('./artist.html?id=${artist.id}')">${artist.name}</button>`;
                    }).join(', ');
                    newRow.innerHTML = `
        <td>${songOrder}</td>
        <td>
          <p class="table-song">${song.name}</p>
          <p class="table-artists">${artists}</p>
        </td>
        <td>${formatDuration(song.duration)}</td>
      `;
                    songList.appendChild(newRow);
                    songOrder++;
                });
            })
            .catch(error => {
                console.error('Error fetching album data:', error);
            });

        function formatDuration(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
        }
    </script>
</head>
<body>
<main>
    <div id="sidebar">
        <div id="logo">
            <h1><span class="fa fa-compact-disc"></span>Melodify</h1>
        </div>
        <div id="quick_actions">
            <button onclick="navigate('./search.html')"><span class="fa fa-search"></span>Search</button>
            <button onclick="navigate('./home.html')"><span class="fa fa-house"></span>Home</button>
        </div>
        <div id="library">
            <div id="library_actions">
                <h2><span class="fa fa-bookmark"></span>Library</h2>
                <div>
                    <button><span class="fa fa-plus"></span></button>
                </div>
            </div>
            <div class="items">
            </div>
        </div>
    </div>
    <div id="content">
        <div id="album">
            <div class="media-banner">
                <img src="./../album.jpg">
                <div class="media-metadata">
                    <h1>AlbumName</h1>
                    <div class="additional_info">
                        <div class="artist-info">
                            <img src="../prince%20michael.jpg">
                            <p>Artist Name</p>
                        </div>
                        <p>Date</p>
                    </div>
                </div>
            </div>
            <div class="song_list">
                <table>
                    <thead>
                    <tr>
                        <th>#</th>
                        <th>Title</th>
                        <th>Duration</th>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div id="queue">
        <h2><span class="fa fa-list"></span>Queue</h2>
        <div class="items">
        </div>

    </div>
</main>
<div id="player">
    <div id="track_info">
        <div class="item">
            <img src="./../album.jpg">
            <div class="info">
                <p class="name">Song name</p>
                <p class="author">Album name</p>
            </div>
        </div>
    </div>
    <div id="player_controls">
        <div class="controls">
            <button><span class="fa fa-backward"></span></button>
            <button><span class="fa fa-circle-play"></span></button>
            <button><span class="fa fa-forward"></span></button>
        </div>
        <div class="track_slider">
            <p id="current_time">0:00</p>
            <input type="range"/>
            <p id="duration">0:00</p>
        </div>
        <audio src="./../windows-xp-startup.mp3"></audio>
    </div>
    <div id="account">
        <button onclick="toggleSidebar()"><span class="fa fa-bookmark active"></span></button>
        <button onclick="toggleQueue()"><span class="fa fa-list active"></span></button>
        <button onclick="toggleTheme()"><span class="fa fa-circle-half-stroke"></span></button>
        <div>
            <span class="fa fa-volume-low"></span>
            <input type="range" min="0" max="1" step="0.1">
        </div>
        <img src="./../prince%20michael.jpg">
    </div>
</div>
</body>
</html>