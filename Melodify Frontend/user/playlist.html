<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Melodify</title>
    <link rel="stylesheet" href="../style/index.css">
    <link rel="stylesheet" href="../style/style.css">
    <link rel="stylesheet" href="../style/collection.css">
    <link rel="stylesheet" href="../style/search.css">
    <link rel="stylesheet" href="../style/controls.css">

    <script src="../js/theme.js"></script>
    <script src="../js/jwt.js" defer></script>
    <script src="../js/redirectToLogin.js" defer></script>
    <script src="../js/redirect.js" defer></script>

    <script src="https://kit.fontawesome.com/5c9473fc67.js" crossorigin="anonymous"></script>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const playlistId = urlParams.get('id');

        fetch(`/api/playlists/${playlistId}`)
            .then(response => response.json())
            .then(playlistData => {
                const h1 = document.querySelector('#playlist h1');
                h1.innerText = playlistData.name;
                h1.onclick = function () {
                    playPlaylist();
                }
                document.querySelector('.image-container div').onclick = function (){
                    playPlaylist();
                }
                document.querySelector('.additional_info > p').innerText = playlistData.creation_date;

                const playlistImage = document.querySelector('.media-banner img');
                playlistImage.src = playlistData.image;

                const songList = document.querySelector('.song_list tbody');
                songList.innerHTML = '';
                let songOrder = 1;
                playlistData.songs.forEach(song => {
                    const newRow = document.createElement('tr');
                    const artists = song.artists.map(artist => {
                        return `<button class="a" onclick="navigate('./artist.html?id=${artist.id}')">${artist.name}</button>`;
                    }).join(', ');
                    newRow.innerHTML = `
        <td>${songOrder}</td>
        <td>
          <p class="table-song">${song.name}</p>
          <p class="table-artists">${artists}</p>
        </td>
        <td>${formatDuration(song.duration)}</td>
      `;
                    songList.appendChild(newRow);
                    songOrder++;
                });
            })
            .catch(error => {
                console.error('Error fetching album data:', error);
            });

        function formatDuration(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
        }
    </script>
</head>
<body>
<main id="playlist">
    <div class="media-banner">
        <div class="image-container">
            <img src="./../album.jpg">
            <div>
                <span class="fa fa-circle-play"></span>
            </div>
        </div>
        <div class="media-metadata">
            <h1>Playlist Name</h1>
            <div class="additional_info">
                <p>Creation Date</p>
            </div>
        </div>
    </div>
    <div class="song_list">
        <table>
            <thead>
            <tr>
                <th>#</th>
                <th>Title</th>
                <th>Duration</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>
                    <button>1</button>
                </td>
                <td>
                    <p class="table-song">Song one</p>
                    <p class="table-artist">Artist name</p>
                </td>
                <td>3:14</td>
            </tr>
            <tr>
                <td>
                    <button>1</button>
                </td>
                <td>
                    <p class="table-song">Song one</p>
                    <p class="table-artist">Artist name</p>
                </td>
                <td>3:14</td>
            </tr>
            <tr>
                <td>
                    <button>1</button>
                </td>
                <td>
                    <p class="table-song">Song one</p>
                    <p class="table-artist">Artist name</p>
                </td>
                <td>3:14</td>
            </tr>
            <tr>
                <td>
                    <button>1</button>
                </td>
                <td>
                    <p class="table-song">Song one</p>
                    <p class="table-artist">Artist name</p>
                </td>
                <td>3:14</td>
            </tr>
            <tr>
                <td>
                    <button>1</button>
                </td>
                <td>
                    <p class="table-song">Song one</p>
                    <p class="table-artist">Artist name</p>
                </td>
                <td>3:14</td>
            </tr>
            <tr>
                <td>
                    <button>1</button>
                </td>
                <td>
                    <p class="table-song">Song one</p>
                    <p class="table-artist">Artist name</p>
                </td>
                <td>3:14</td>
            </tr>
            <tr>
                <td>
                    <button>1</button>
                </td>
                <td>
                    <p class="table-song">Song one</p>
                    <p class="table-artist">Artist name</p>
                </td>
                <td>3:14</td>
            </tr>
            <tr>
                <td>
                    <button>1</button>
                </td>
                <td>
                    <p class="table-song">Song one</p>
                    <p class="table-artist">Artist name</p>
                </td>
                <td>3:14</td>
            </tr>
            <tr>
                <td>
                    <button>1</button>
                </td>
                <td>
                    <p class="table-song">Song one</p>
                    <p class="table-artist">Artist name</p>
                </td>
                <td>3:14</td>
            </tr>
            <tr>
                <td>
                    <button>1</button>
                </td>
                <td>
                    <p class="table-song">Song one</p>
                    <p class="table-artist">Artist name</p>
                </td>
                <td>3:14</td>
            </tr>
            <tr>
                <td>
                    <button>1</button>
                </td>
                <td>
                    <p class="table-song">Song one</p>
                    <p class="table-artist">Artist name</p>
                </td>
                <td>3:14</td>
            </tr>
            <tr>
                <td>
                    <button>1</button>
                </td>
                <td>
                    <p class="table-song">Song one</p>
                    <p class="table-artist">Artist name</p>
                </td>
                <td>3:14</td>
            </tr>
            <tr>
                <td>
                    <button>1</button>
                </td>
                <td>
                    <p class="table-song">Song one</p>
                    <p class="table-artist">Artist name</p>
                </td>
                <td>3:14</td>
            </tr>
            <tr>
                <td>
                    <button>1</button>
                </td>
                <td>
                    <p class="table-song">Song one</p>
                    <p class="table-artist">Artist name</p>
                </td>
                <td>3:14</td>
            </tr>
            </tbody>
        </table>
    </div>
</main>
</body>
</html>